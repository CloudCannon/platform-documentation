---
_schema: guide-item
_uuid: af2b9618-a24c-40a8-9b05-fc396158cc73
_created_at: "2023-02-01 02:40:30 +0000"
title: "Page Building"
nav_title: "Page Building"
order: 7
published: true
image: /documentation/static/bookshop-11ty/bookshop-astro-og.png
description: "Use your components to visually build pages from scratch"
tags: []
related_articles: null
related_links: []
---

With your components live rendering and your Structures created in CloudCannon,
we now have the ingredients to create a page-building experience in the CMS.

## Looping components

Once you have a few more components built out, an ideal front-matter section might look like this:

<comp.CodeBlock language="yml" source="src/pages/index.md">
```
---
layout: ../layouts/PageLayout.astro
content_blocks:
  
  - _bookshop_name: hero
    title: Kākā
    subtitle: The New Zealand kākā is a large species of parrot
  
  - _bookshop_name: content
    content_markdown: >-
      The New Zealand kākā lives in lowland and mid-altitude native forest
  
  - _bookshop_name: image
    image_url: /uploads/Scrapping_kaka.jpg
    image_alt: The bird that screams loudest and most persistently gets to own the branch
  
  - _bookshop_name: stats
    length: 45cm
    weight: 452g
    color: reddish
---
```
</comp.CodeBlock>

To render this array of components on the page, we can loop over them and use the dynamic components
we covered in [Using Bookshop components](/documentation/guides/bookshop-astro-guide/using-components/#rendering-dynamic-components):

<comp.CodeBlock language="astro" source="src/layouts/PageLayout.astro">
```
---
const { frontmatter } = Astro.props;
const components = import.meta.glob("../components/**/*.astro", {
  eager: true,
});
---

<main>
  {frontmatter.content_blocks.map((block) => {
    const name = `../components/${block._bookshop_name}.astro`;
    const Component = components[name].default;
    return <Component bookshop:live {...block} />;
  })}
</main>

```
</comp.CodeBlock>

While this will work to render these components, using this directly
in a layout on your site will cause problems when live editing. 
Bookshop can only live render changes within the boundaries of Bookshop components.  

This means that if the above loop is placed directly in one of your Astro files,
the live editing boundaries will be:

<comp.CodeBlock language="astro" source="src/layouts/PageLayout.astro">
```
{frontmatter.content_blocks.map((block) => {
  const name = `../components/${block._bookshop_name}.astro`;
  const Component = components[name].default;
  return <>
    {/* start live editing */}
    <Component bookshop:live {...block} />;
    {/* end live editing */}
  </>
})}
```
</comp.CodeBlock>

In this setup, each component individually will update changes live,
but rearranging or adding new components will not render correctly 
because the `frontmatter.content_blocks.map` loop is not being rerendered.

The solution to this is to move this loop inside a Bookshop component. In this case,
instead of adding this component to our `components` directory, we're instead going to create a
`shared/astro` directory and add our component there instead.

If you're following along, create a `shared/astro` directory in your `src` folder and then
add a `page.astro` component that renders a `content_blocks` array.

Afterward, you should have a directory structure like this:
<comp.Tree>
```
src/
>> components/
>  >> sample/
>     >> sample.astro
>> shared/
   >> astro/
      >> page.astro #*
```
</comp.Tree>

And, a `page.astro` like this:
<comp.CodeBlock language="astro" source="src/shared/astro/page.astro">
```
---
const { contentBlocks } = Astro.props;
const components = import.meta.glob("../../components/**/*.astro", {
  eager: true,
});
---

<main>
  {contentBlocks.map((block) => {
    const name = `../../components/${block._bookshop_name}.astro`;
    const Component = components[name].default;
    return <Component {...block} />;
  })}
</main>

```
</comp.CodeBlock>

Note that we don't need to add the `bookshop:live` directive to the subcomponents within a page
because we're going to live render the entire page component.

## Shared Components

The `shared/astro` directory is a location for you to place components
that need to rerender in the Visual Editor but aren't semantically a "component"
that an editor would add to a page. Apart from this distinction, these files are
functionally the same as your components, and can be imported and used like any other component:

<comp.CodeBlock language="astro" source="src/layouts/PageLayout.astro">
```
---
import Page from '../shared/astro/page.astro';

const { frontmatter } = Astro.props;
---

<Page bookshop:live contentBlocks={frontmatter.content_blocks} />
```
</comp.CodeBlock>

By passing all of the data to our `page` helper and looping within,
Bookshop is able to update the entire page when the `content_blocks` array is changed.

## Taking stock

With the steps taken so far, you should have the framework for a fully functional page builder,
rendering live when editing on CloudCannon. This is a great moment to jump into your codebase,
start migrating some components, and experiment with the system.

The following sections of this guide will cover some of Bookshop's remaining features that can help polish
the page-building experience but aren't required while setting things up.
